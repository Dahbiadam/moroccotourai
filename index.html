<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MoroccoTour AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-blue-50 to-indigo-100 min-h-screen">
  <header class="bg-white shadow">
    <div class="container mx-auto py-4 px-6">
      <h1 class="text-2xl font-bold text-indigo-600">MoroccoTour AI</h1>
    </div>
  </header>
  <main class="container mx-auto mt-6 p-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Chat -->
    <section class="bg-white p-6 rounded-lg shadow-lg flex flex-col">
      <h2 class="text-xl font-semibold mb-4">Ask the AI</h2>
      <textarea id="chatInput" rows="4" class="border rounded p-2 mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-300" placeholder="Type your question..."></textarea>
      <button id="chatBtn" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition mb-4">Send</button>
      <div id="chatResponse" class="flex-1 overflow-auto bg-gray-100 p-3 rounded text-gray-800"></div>
    </section>
    <!-- Tools -->
    <section class="space-y-6">
      <!-- Weather & Emergency -->
      <div class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4">Weather & Emergency</h2>
        <div class="flex gap-2 mb-3">
          <input id="weatherCity" type="text" placeholder="City" class="flex-1 border rounded p-2 focus:outline-none focus:ring-2 focus:ring-blue-300"/>
          <button id="weatherBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">Weather</button>
        </div>
        <pre id="weatherResult" class="bg-gray-100 p-3 rounded overflow-auto"></pre>
        <button id="emergencyBtn" class="mt-3 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">Show Emergency Numbers</button>
        <div id="emergencyResult" class="mt-2 text-gray-800"></div>
      </div>
      <!-- Map -->
      <div class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4">Map Preview</h2>
        <div class="flex gap-2 mb-3">
          <input id="mapCity" type="text" placeholder="City" class="flex-1 border rounded p-2 focus:outline-none focus:ring-2 focus:ring-indigo-300"/>
          <button id="mapBtn" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition">Generate Map</button>
        </div>
        <div id="mapFrame" class="h-64 rounded overflow-hidden border"></div>
      </div>
      <!-- Trip Planner -->
      <div class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4">Trip Planner</h2>
        <div class="space-y-2">
          <input id="tripCity" type="text" placeholder="City" class="w-full border rounded p-2 focus:outline-none focus:ring-2 focus:ring-indigo-300"/>
          <div class="flex gap-2">
            <input id="startDate" type="date" class="flex-1 border rounded p-2"/>
            <input id="endDate" type="date" class="flex-1 border rounded p-2"/>
          </div>
          <button id="tripBtn" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 transition">Plan Trip</button>
        </div>
        <ul id="tripResult" class="mt-3 list-decimal pl-5 text-gray-800"></ul>
      </div>
    </section>
  </main>
  <footer class="text-center py-4 text-gray-600">&copy; 2025 MoroccoTour AI</footer>
  <script>
    const baseUrl = window.location.hostname.includes('localhost') 
      ? 'http://localhost:8000'
      : 'https://d672-34-135-199-85.ngrok-free.app';

    async function sendChat() {
      const input = document.getElementById('chatInput').value;
      const res = await fetch(`${baseUrl}/api/v1/chat`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({ message: input, user_id: 'user1', language:'en' }),
      });
      const data = await res.json();
      document.getElementById('chatResponse').innerText = data.response;
    }
    document.getElementById('chatBtn').addEventListener('click', sendChat);

    async function getWeather() {
      const city = document.getElementById('weatherCity').value;
      const res = await fetch(`${baseUrl}/api/v1/weather?city=${encodeURIComponent(city)}`);
      const data = await res.json();
      document.getElementById('weatherResult').innerText = 
        JSON.stringify(data.current_weather, null, 2);
    }
    document.getElementById('weatherBtn').addEventListener('click', getWeather);

    async function showEmergency() {
      const city = document.getElementById('weatherCity').value || 'Morocco';
      const res = await fetch(`${baseUrl}/api/v1/emergency?city=${encodeURIComponent(city)}`);
      const data = await res.json();
      document.getElementById('emergencyResult').innerHTML = 
        '<ul>' +
        Object.entries(data).map(([k,v])=>`<li><strong>${k}</strong>: ${v}</li>`).join('') +
        '</ul>';
    }
    document.getElementById('emergencyBtn').addEventListener('click', showEmergency);

    async function genMap() {
      const city = document.getElementById('mapCity').value;
      const frame = document.getElementById('mapFrame');
      frame.innerHTML = `<iframe src="${baseUrl}/api/v1/map?city=${encodeURIComponent(city)}" class="w-full h-full border-0"></iframe>`;
    }
    document.getElementById('mapBtn').addEventListener('click', genMap);

    async function planTrip() {
      const city = document.getElementById('tripCity').value;
      const start = document.getElementById('startDate').value;
      const end = document.getElementById('endDate').value;
      const res = await fetch(`${baseUrl}/api/v1/plan-trip`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({ city, start_date: start, end_date: end })
      });
      const data = await res.json();
      const list = document.getElementById('tripResult');
      list.innerHTML = '';
      data.plan.forEach(item => {
        const li = document.createElement('li'); li.textContent=item;
        list.appendChild(li);
      });
    }
    document.getElementById('tripBtn').addEventListener('click', planTrip);
  </script>
</body>
</html>
